@using System.Security.Claims
@using MudBlazor
@using MudBlazor.Services
@inherits LayoutComponentBase
@inject NavigationManager NavManager
@inject AuthenticationStateProvider AuthenticationStateProvider

<MudThemeProvider/>
<MudDialogProvider/>
<MudSnackbarProvider/>


            <AuthorizeView>
                <NotAuthorized>
                    
                    <MudBlazor.MudAppBar Color="Color.Primary" Fixed=false>
                           <MudIconButton Icon="@Icons.Material.Filled.Menu" Color="Color.Inherit" Edge="Edge.Start" OnClick=@MenuOpen/>
                            <MudSpacer />
                            <NavLink class="nav-link" href="Login" Match="NavLinkMatch.All">
                        Login
                    </NavLink>
                    </MudBlazor.MudAppBar>

                    
                </NotAuthorized>
                <Authorized>

                       <MudBlazor.MudAppBar Color="Color.Primary" Fixed=false>
                           <MudIconButton Icon="@Icons.Material.Filled.Menu" Color="Color.Inherit" Edge="Edge.Start" OnClick=@MenuOpen/>
                           <MudSpacer />
                            @FirstName  @LastName
                    <NavLink class="nav-link" href="Logout" Match="NavLinkMatch.All">
                    logout
                    </NavLink>
                   
                    </MudBlazor.MudAppBar>

                    
                </Authorized>
            </AuthorizeView>

            <MudLayout>
  <MudDrawer @bind-Open="@sideMenuOpen" Anchor="Anchor.Start" >
        <MudDrawerHeader>
        <MudText Typo="Typo.h6">Blog Menu</MudText>
    </MudDrawerHeader>
    <MudNavMenu>

             <AuthorizeView>
                <NotAuthorized>

        <MudNavLink Match="NavLinkMatch.All">Recents</MudNavLink>

        <MudNavGroup Title="Categories">
             <MudNavLink Match="NavLinkMatch.All">Blazor</MudNavLink>
            <MudNavLink Match="NavLinkMatch.All">Thrash</MudNavLink>
        </MudNavGroup>

        </NotAuthorized>
                  <Authorized>

        <MudNavLink Match="NavLinkMatch.All">Recents</MudNavLink>
        <MudNavLink Match="NavLinkMatch.All">My Profile</MudNavLink>
        <MudNavGroup Title="Categories">
             <MudNavLink Match="NavLinkMatch.All">Blazor</MudNavLink>
            <MudNavLink Match="NavLinkMatch.All">Thrash</MudNavLink>
        </MudNavGroup>

        </Authorized>
        </AuthorizeView>
    </MudNavMenu>

    </MudDrawer>


    <MudMainContent>
        @Body
    </MudMainContent>
</MudLayout>


@code {
    public bool sideMenuOpen { get; set; } = true;

         public string? FirstName { get; set; }
        public string? LastName { get; set; }
        private ClaimsPrincipal AuthenticationStateProviderUser { get; set; }

        protected override async Task OnParametersSetAsync()
        {
            AuthenticationState authenticationState;
            authenticationState = await AuthenticationStateProvider.GetAuthenticationStateAsync();

            this.AuthenticationStateProviderUser = authenticationState.User;
            this.FirstName = this.AuthenticationStateProviderUser.FindFirst(c => c.Type == ClaimTypes.GivenName)?.Value;
            this.LastName = this.AuthenticationStateProviderUser.FindFirst(c => c.Type == ClaimTypes.Surname)?.Value;
        }

    public void MenuOpen()
    {
        sideMenuOpen = !sideMenuOpen;
    }
}
